"0","setdiff(stds$Assay, SoilCT$Assay)"
"1","character(0)
"
"0","setdiff(SoilCT$Assay, stds$Assay)"
"1"," [1]"
"1"," ""erm(36)""     "
"1"," ""aac3-Via""    "
"1"," ""aadA17""      "
"1"," ""int1-a-marko"""
"1"," ""tnpA1""       "
"1"," ""tnpA2""       "
"1"," ""aadD""        "
"1","
"
"1"," [8]"
"1"," ""tnpA3""       "
"1"," ""lnuA""        "
"1"," ""aphA3""       "
"1"," ""tnpA5""       "
"1"," ""IS1247""      "
"1"," ""cadC""        "
"1"," ""tnpA6""       "
"1","
"
"1","[15]"
"1"," ""cmr""         "
"1"," ""tnpA7""       "
"1","
"
"0","s <- stds %>%"
"0","  drop_na(""counts"")"
"0",""
"0","w <- SoilCT %>%"
"0","  filter(!Assay %in% setdiff(SoilCT$Assay, stds$Assay))"
"0",""
"0","w <- w %>%"
"0","  select(plot, sample_day, treatment, Assay, Value, gene_class)"
"0",""
"0","setdiff(s$Assay, w$Assay)"
"1","character(0)
"
"0","setdiff(w$Assay, s$Assay)"
"1","character(0)
"
"0","dput(unique(w$Assay)) # Use this list for the next map function"
"1","c(""16S_Eub_338_518"", ""sul1"", ""tetW"", ""sul2"", ""erm(C)"", ""tetX"", 
"
"1","""tetbP"", ""aadA9"", ""tetG"", ""intI1F165_clinical"", ""tetH"", ""tetL"", 
"
"1","""tetM"", ""IS6100"", ""tetT"", ""strB"")
"
"0","normby16s <- c(""16S_Eub_338_518"", ""sul1"", ""tetW"", ""sul2"", ""erm(C)"", ""tetX"", "
"0","""tetbP"", ""aadA9"", ""tetG"", ""tetH"", ""tetL"", "
"0","""tetM"", ""IS6100"", ""tetT"", ""strB"") %>%"
"0","  map( ~ get_counts(s, w, gene = .x)) %>%"
"0","  reduce(full_join)"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"1","Joining, by = c(""plot"", ""sample_day"", ""treatment"", ""Assay"", ""Value"", ""gene_class"", ""counts"")
"
"0","#saveRDS(normby16s, file = ""../data/WorArgBySixS.RDS"") # note these are not normalized by 16s, just counts from standard curves"
"0",""
"0","norms <- normby16s %>%"
"0","  unite(ID, c(""plot"", ""sample_day"", ""Assay""), sep = ""."", remove = F) %>%"
"0","  select(!Value) %>%"
"0","  dplyr::group_by(plot, sample_day, Assay) %>%"
"0","  dplyr::mutate(rep = seq_along(ID)) %>%"
"0","  select(plot, sample_day, rep, treatment, Assay, gene_class, counts) %>%"
"0","  ungroup()"
"0",""
"0","SixS <- norms %>%"
"0","  filter(Assay == ""16S_Eub_338_518"") %>%"
"0","  dplyr::rename(SixSCount = counts) %>%"
"0","  select(plot, sample_day, rep, SixSCount) "
"0",""
"0","dfdf <- norms %>%"
"0","  left_join(SixS, by = c(""plot"", ""sample_day"", ""rep"")) %>%"
"0","  filter(!Assay == ""16S_Eub_338_518"")"
"0",""
"0","# Now got to divide each count of each gene by the 16s number"
"0",""
"0","test <- w %>% # Order ARGs based on class"
"0","  arrange(gene_class) "
"0",""
"0","levels <- dput(levels(factor(test$Assay))) "
"1","c(""16S_Eub_338_518"", ""aadA9"", ""erm(C)"", ""intI1F165_clinical"", 
"
"1","""IS6100"", ""strB"", ""sul1"", ""sul2"", ""tetbP"", ""tetG"", ""tetH"", ""tetL"", 
"
"1","""tetM"", ""tetT"", ""tetW"", ""tetX"")
"
"0","dfdf$treatment = factor(dfdf$treatment, "
"0","                        levels = c('WCS', 'WCSM', 'WCM'))"
"0",""
"0","levels(dfdf$treatment)"
"1","[1]"
"1"," ""WCS"" "
"1"," ""WCSM"""
"1"," ""WCM"" "
"1","
"
"0","levels(dfdf$treatment) <- list(""CS"" = ""WCS"", ""CSM"" = ""WCSM"", ""CM"" = ""WCM"")"
"0",""
"0",""
"0","heatmap2 <- ggplot(dfdf, aes(as.factor(sample_day), ordered(Assay, levels = levels))) +"
"0","  geom_tile(aes(fill = counts/SixSCount), colour = ""white"", size = 0.1) +"
"0","  scale_fill_viridis(name = ""ARG count \nnormalized by 16S"")  +"
"0","  labs(x = ""Sample day"", y = ""ARG"") +"
"0","  facet_nested(gene_class ~ treatment + plot, scales = ""free"", space = ""free"") + theme_classic() +"
"0","  theme("
"0","    panel.background = element_rect(color = 'black', size = 1.4),"
"0","    strip.text.x = element_text(size = 10, face = 'bold'),"
"0","    strip.background = element_rect(colour = 'black', size = 1.4),"
"0","    axis.text.x = element_text(angle = 45, hjust=1),"
"0","    legend.position = ""top"","
"0","    legend.key.width = unit(.75, ""in"")"
"0","  ) "
"0",""
"0","heatmap2 +"
"0","  scale_y_discrete("
"0","    name = NULL,"
"0","    labels = labels"
"0","  ) +"
"0","  theme("
"0","    axis.text.y = element_markdown()"
"0","  )"
