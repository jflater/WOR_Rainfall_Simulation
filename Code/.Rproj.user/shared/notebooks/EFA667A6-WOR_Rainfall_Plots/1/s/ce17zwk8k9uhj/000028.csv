"0","global_size = 12 # Font size"
"0","phydf <- worle.manure %>%"
"0","  tax_glom(taxrank = ""Phylum"") %>%"
"0","  transform_sample_counts(function(x) x / sum(x)) %>%"
"0","  psmelt()  # Take manure phyloseq object and glom taxa at phyla level. Transform counts to relative abundance and melt to a data frame. "
"0",""
"0","summary <- phydf %>%  # Make a plot"
"0","  group_by(Phylum) %>%"
"0","  summarise( "
"0","    n=n(),"
"0","    mean=mean(Abundance),"
"0","    sd=sd(Abundance)"
"0","  ) %>%"
"0","  mutate(se = sd/sqrt(n))  %>%"
"0","  mutate(ic = se * qt((1-0.05)/2 + .5, n-1)) %>%"
"0","  arrange(-mean)"
"0",""
"0","summary$Phylum <- factor(summary$Phylum, levels = summary$Phylum[order(-summary$mean)]) # arrange won't change order of Phylum factor levels"
"0",""
"0","p1 <- ggplot(summary) +"
"0","  theme_classic() +"
"0","  geom_bar(aes(x = Phylum, y = mean, fill = Phylum), stat = ""identity"", "
"0","           position = position_dodge(width = 0.75)) +"
"0","  geom_errorbar( aes(x = reorder(Phylum, -mean), ymin = mean - ic, ymax = mean + ic), width = 0.2, colour = ""black"", size= 0.5) +"
"0","  labs(y = ""Relative abundance of phyla"", x = ""Phylum"") +"
"0","  scale_fill_manual(values = colors) +"
"0","  theme(legend.position = ""none"", "
"0","        axis.text.x = element_text(angle = 45, hjust = 1)) +"
"0","  scale_y_continuous(labels = function(x) paste0(x*100, ""%"")) +"
"0",""
"0","  theme(text = element_text(size = global_size, family = ""Times""))"
"0","p1"
