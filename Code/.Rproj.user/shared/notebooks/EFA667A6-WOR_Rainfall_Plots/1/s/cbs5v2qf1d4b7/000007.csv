"0","p <- phylogeny_profile(sp, classification = 'Phylum', treatment = c(""treatment""), merge = TRUE, relative_abundance = F) +"
"0","  facet_nested(. ~ treatment + plot, scales = ""free"", space = ""free"") +"
"0","  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),"
"0","        legend.position = ""top"") +"
"0","  guides(fill = guide_legend(ncol=3)) +"
"0","  labs(y = ""Relative abundance of MAB"") +"
"0","  scale_x_discrete()"
"2","Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing scale.
"
"0","df <- p$data %>%"
"0","  separate(col = unique_id, into = c(""p"", ""time""), sep = ""-"") "
"0",""
"0","levels(df$treatment) <- c(""CM"", ""CSM"", ""CS"")"
"0",""
"0","df$treatment <- ordered(df$treatment, levels = c(""CS"", ""CSM"", ""CM"")) "
"0",""
"0","breaks <- df %>%"
"0","  filter(plot == 4, time == 3) %>%"
"0","  group_by(Phylum) %>%"
"0","  summarise(mean = mean(Abundance)) %>%"
"0","  arrange(mean) %>% "
"0","  select(Phylum) "
"0",""
"0","df$Phylum <- factor(df$Phylum, levels = breaks$Phylum)"
"0",""
"0","mabbarplot <- ggplot(data = df, aes(x = time, y = Abundance, fill = Phylum)) +"
"0","  geom_bar(stat = ""identity"", colour = ""black"") +"
"0","  facet_nested(. ~ treatment + plot, scales = ""free"", space = ""free"") +"
"0","  theme_classic() +"
"0","  theme("
"0","    text = element_text(size = global_size, family = ""Times""),"
"0","    legend.position = ""top"","
"0","    panel.background = element_rect(color = 'black', size = 1.4),"
"0","    strip.text.x = element_text(size = 10, face = 'bold'),"
"0","    strip.background = element_rect(colour = 'black', size = 1.4),"
"0","    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +"
"0","    scale_fill_manual(aesthetics = ""fill"", values = subset(colors, names(colors) %in% df$Phylum), breaks = breaks$Phylum) +"
"0","    labs(x = ""Sample time (min) after runoff"", y = ""Relative abundance of MAB"") +"
"0","  scale_x_discrete(labels = c(""1"" = ""2.5"", ""2"" = ""7.5"", ""3"" = ""12.5"", ""4"" = ""17.5"", ""5"" = ""22.5"", ""6"" = ""27.5"")) +"
"0","  scale_y_continuous(labels = function(x) paste0(x*100, ""%"")) +"
"0","  guides(fill = guide_legend(nrow = 4))"
"0",""
"0","mabbarplot"
