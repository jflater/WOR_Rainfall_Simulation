"0","summary <- df %>%"
"0","  filter(!treatment == ""CS"") %>%"
"0","  group_by(Phylum, "
"0","           plot, "
"0","           treatment) %>%"
"0","  summarise( "
"0","    n=n(),"
"0","    mean=mean(Abundance),"
"0","    sd=sd(Abundance)) %>%"
"0","  mutate(se = sd/sqrt(n))  %>%"
"0","  mutate(ic = se * qt((1-0.05)/2 + .5, n-1)) %>%"
"0","  arrange(plot, -mean) %>% "
"0","  ungroup()"
"1","`summarise()` has grouped output by 'Phylum', 'plot'. You can override using the `.groups` argument.
"
"0","EightPhyla <- summary %>%"
"0","  group_by(Phylum) %>%"
"0","  mutate(mean = mean(mean)) %>%"
"0","  arrange(-mean) %>%"
"0","  select(Phylum) %>%"
"0","  distinct() %>%"
"0","  head(8) "
"0",""
"0","summary$plot <- as.factor(summary$plot)"
"0",""
"0","summary <- summary %>%"
"0","  filter(Phylum %in% EightPhyla$Phylum)"
"0",""
"0","ggplot(summary, aes(x = reorder(Phylum, -mean), y = mean, fill = plot)) +"
"0","  geom_bar(stat = ""identity"", "
"0","           position = position_dodge(width = 1)) +"
"0","  geom_errorbar(aes(x = reorder(Phylum, -mean), ymin = mean - ic, ymax = mean + ic), "
"0","           position = position_dodge(width = 1), width = 0.2, colour = ""black"", size= 0.5) +"
"0","  labs(y = ""Relative abundance of phyla"", x = ""Phylum"") +"
"0","  facet_grid( ~ treatment) +"
"0","  theme_classic() + "
"0","  theme(text = element_text(size = global_size, family = ""Times""),"
"0","    axis.text.x = element_text(angle = 90, hjust = 1)) +"
"0","  scale_fill_viridis_d(name = ""Plot"") +"
"0","  scale_y_continuous(labels = function(x) paste0(x*100, ""%"")) # Here we can multiply the relative abundance by 100 and add a % mark, note that any tables generated will still need to be multiplied by 100. "
