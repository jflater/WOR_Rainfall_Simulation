[
  {
    "objectID": "16S.html",
    "href": "16S.html",
    "title": "Prairie Strips Impact on Transport of Antibiotic Resistance Indicators in Poultry Manure",
    "section": "",
    "text": "Introduction\nThis code was used to generate figures for a publication titled: Prairie Strips Impact on Transport of Antibiotic Resistance Indicators in Poultry Manure\nThe manuscript is available here:\nThe project was designed to evaluate if the conservation practice of planting strips of prairie grasses within agricultural fields might attenuate the transport of manure associated genes and bacteria.\nPoultry manure was applied to small plots appended with prairie strips and rainfall was simulated on the manure applied ground. Runoff water samples were collected after passing through the prairie strip and soil samples were collected before and after the rainfall simulation. In both soil and water samples we looked for and tracked the presence and abundance of manure associated bacteria and genes.\nFigure 1\nFigure was is a taxonomic profile of the bacteria present in the poultry manure that was used as a fertilizer. Manure was applied to six of nine plots, two plots received manure each day of a rainfall simulation. Rainfall simulations were performed on the nine plots over three days, one day each for a block of plots. Each block contained one plot from each treatment. The treatments were:\nCrop + Strip (CS)\nCrop + Strip + Manure (CSM)\nCrop + Manure (CM)\nThe manure applied to each plot came from a single ~ 60 lbs batch of manure. When manure was applied to each plot, a sample of manure was taken to be analyzed for bacteria and antibiotic resistance genes. To track manure associated bacteria, we must first characterize the bacteria present. Here we have six manure samples and a bar plot representing the relative abundance of bacterial phyla in each sample. This data was generated using NGS sequencing of the 16S gene and analyzed using DADA2 to generate a count of the different taxa present in the various samples from the rainfall simulation.\n16S Figures\n\n# Worle data\nworle <- readRDS(\"Data/Worle_curated.RDS\") \n\n# set taxa to ASV, otherwise uses the sequence as taxa name\ntaxa_names(worle) <- paste0(\"ASV\", seq(ntaxa(worle)))\n\n# rename NA taxa as \"Unclassified\"\nTax.Table <- data.frame(tax_table(worle)) %>%\n  replace(is.na(.), \"Unclassified\")\n\n# replace tax table \ntax_table(worle) <- as.matrix(Tax.Table)\n\nFirst, visualize differences in communities by plotting PCoA ordination of the Bray-Curtis dissimilarity\n\ncolnames(sample_data(worle))\n\n [1] \"unique_id\"        \"experiment\"       \"matrix\"           \"treatment\"       \n [5] \"plot\"             \"sample_day\"       \"depth\"            \"in_plot_location\"\n [9] \"block\"            \"strip\"            \"manure_treatment\" \"soil_type\"       \n\nsample_data(worle)$treatment[is.na(sample_data(worle)$treatment)] <- \"manure\"\n\npcoa <- pcoa_phyloseq(worle, c('matrix', 'treatment'), circle = T) +\n  scale_fill_viridis_d() +\n  theme_minimal()\n\nScale for 'fill' is already present. Adding another scale for 'fill', which\nwill replace the existing scale.\n\npcoa\n\n\n\nggsave(filename = \"Figures/PCoA.jpeg\", plot = pcoa, device = \"jpeg\", width = 7.0, height = 6.0, units = \"in\", dpi = 350)\n\n\nworle.manure <- subset_samples(worle, matrix == \"manure\") %>% # subset to manure\n  filter_taxa(function(x) sum(x) >= 1, T)  # Remove taxa observed less than once in these samples\n\nAs we make plots of taxa, it’s easier to understand if consistent colors are used for the various phyla. We can assign a color to each of these phyla then manually color plots based on this.\n\nset.seed(010101)\n\n# make a list of unique phyla\nphylalist <- data.frame(tax_table(worle), row.names = NULL) %>%\n  select(Phylum) %>%\n  unique() \nphylalist$Phylum <- as.character(phylalist$Phylum)\n\n\nlibrary(colorspace)  # this package will generate a palette based on number and desired colors\n\n# assign color from \"viridis\" package to each phyla and name the list with phyla names\ncolors <- sequential_hcl(n_distinct(phylalist), palette = \"viridis\") %>%\n  setNames(sort(phylalist$Phylum))\n\n\nFigure 1\nLet’s calculate the relative abundance of each phyla in the manure and generate summary statistics (mean, standard error, and interquartile range) ::: {.cell}\nglobal_size = 12 # Font size\nphydf <- worle.manure %>%\n  tax_glom(taxrank = \"Phylum\") %>%\n  transform_sample_counts(function(x) x / sum(x)) %>%\n  psmelt()  # Take manure phyloseq object and glom taxa at phyla level. Transform counts to relative abundance and melt to a data frame. \n\nsummary <- phydf %>%  # Make a plot\n  group_by(Phylum) %>%\n  summarise( \n    n=n(),\n    mean=mean(Abundance),\n    sd=sd(Abundance)\n  ) %>%\n  mutate(se = sd/sqrt(n))  %>%\n  mutate(ic = se * qt((1-0.05)/2 + .5, n-1)) %>%\n  arrange(-mean)\n\nsummary$Phylum <- factor(summary$Phylum, levels = summary$Phylum[order(-summary$mean)]) # arrange won't change order of Phylum factor levels\n\np1 <- ggplot(summary) +\n  theme_classic() +\n  geom_bar(aes(x = Phylum, y = mean, fill = Phylum), stat = \"identity\", \n           position = position_dodge(width = 0.75)) +\n  geom_errorbar( aes(x = reorder(Phylum, -mean), ymin = mean - ic, ymax = mean + ic), width = 0.2, colour = \"black\", size= 0.5) +\n  labs(y = \"Relative abundance of phyla\", x = \"Phylum\") +\n  scale_fill_manual(values = colors) +\n  theme(legend.position = \"none\", \n        axis.text.x = element_text(angle = 45, hjust = 1)) +\n  scale_y_continuous(labels = function(x) paste0(x*100, \"%\")) +\n  geom_text(x = \"Proteobacteria\", y = 0.60, label = \"A\", size = 8, family = \"Times\") +\n  theme(text = element_text(size = global_size, family = \"Times\")) \n  \np1\n\n\n\n# We can make a second smaller plot to show the abundances of the low abundance phyla\n\np2 <- ggplot(subset(summary, Phylum %in% tail(summary$Phylum, -5))) +\n  theme_classic() +\n  geom_bar(aes(x = reorder(Phylum, -mean), y = mean, fill = Phylum), stat = \"identity\", \n           position = position_dodge(width = 0.75)) +\n  geom_errorbar( aes(x = reorder(Phylum, -mean), ymin = mean - ic, ymax = mean + ic), width = 0.2, colour = \"black\", size= 0.5) +\n  labs(x = NULL, y = NULL) +\n  scale_fill_manual(values = colors) +\n  theme(legend.position = \"none\", \n        axis.text.x = element_text(angle = 45, hjust = 1)) +\n  scale_y_continuous(labels = function(x) paste0(x*100, \"%\")) +\n  geom_text(x = \"Tenericutes\", y = 0.0060, label = \"B\", size = 8, family = \"Times\") +\n  theme(text = element_text(size = global_size, family = \"Times\")) \n\np2\n\n\n\np3 <- p1 + annotation_custom(ggplotGrob(p2), xmin = \"Deinococcus-Thermus\", xmax = \"Deferribacteres\", ymin = .05, ymax = .65) \n\np3\n\n\n\n:::\nWe can see that the manure is mostly represented by five phyla, Firmicutes, Proteobacteria, Bacteroidetes, Actinobacetria, and Deinococcus-Thermus.\n\n# Use ggsave to save plot. I chose 6.5\" wide because most word docs are 8.5\" with 2 x 1\" margins. Keep the height below 9.5\" to save room for a caption. When you insert into your document, change the size to 6.5\" wide to ensure that the plot looks visually the same. \n\nggsave(filename = \"Figures/Fig1.jpeg\", plot = last_plot(), device = \"jpeg\", width = 7.0, height = 6.0, units = \"in\", dpi = 350)\n\nThe specific abundances of phyla are:\n\nphydf %>%\n  group_by(Phylum) %>%\n  summarise(Mean = mean(Abundance), StdDev = sd(Abundance), min = min(Abundance), max = max(Abundance)) %>%\n  arrange(-Mean)\n\n# A tibble: 20 x 5\n   Phylum                        Mean    StdDev       min       max\n   <chr>                        <dbl>     <dbl>     <dbl>     <dbl>\n 1 Firmicutes               0.555     0.0907    0.441     0.678    \n 2 Proteobacteria           0.200     0.0668    0.124     0.294    \n 3 Bacteroidetes            0.126     0.0483    0.0714    0.191    \n 4 Actinobacteria           0.0890    0.0170    0.0669    0.105    \n 5 Deinococcus-Thermus      0.0187    0.00770   0.00633   0.0261   \n 6 Chloroflexi              0.00405   0.00262   0.00185   0.00842  \n 7 Tenericutes              0.00173   0.00166   0.0000728 0.00455  \n 8 Planctomycetes           0.000927  0.000411  0.000337  0.00137  \n 9 Unclassified             0.000871  0.00116   0         0.00329  \n10 Euryarchaeota            0.000706  0.00108   0         0.00289  \n11 Verrucomicrobia          0.000526  0.000602  0         0.00158  \n12 Acidobacteria            0.000353  0.000303  0         0.000705 \n13 Synergistetes            0.000261  0.000548  0         0.00137  \n14 Elusimicrobia            0.000195  0.000385  0         0.000962 \n15 Fusobacteria             0.000153  0.000272  0         0.000670 \n16 candidate_division_WPS-1 0.000110  0.000160  0         0.000407 \n17 Cloacimonetes            0.0000796 0.000142  0         0.000351 \n18 Armatimonadetes          0.0000506 0.0000659 0         0.000166 \n19 Spirochaetes             0.0000281 0.0000688 0         0.000169 \n20 Deferribacteres          0.0000123 0.0000302 0         0.0000740\n\n\n\n\nSupp Figure S2\nAbundance of manure associated taxa\nNow let’s look at the number of unique taxa in the various samples.\n\n# strip subset, all strip soil from baseline samples in addition to no_manure_strip treatment, note the | operator \nworle.strip <- subset_samples(worle, matrix == \"soil\" & sample_day == \"Baseline\" & soil_type == \"strip\" | \n                                matrix == \"soil\" & treatment == \"no_manure_strip\" & soil_type == \"strip\") %>%\n  filter_taxa(function(x) sum(x) >= 1, T) \n\nworle.crop <- subset_samples(worle, matrix == \"soil\" & sample_day == \"Baseline\" & soil_type == \"crop\" | \n                                matrix == \"soil\" & treatment == \"no_manure_strip\" & soil_type == \"crop\") %>%\n  filter_taxa(function(x) sum(x) >= 1, T)\n\nworle.border <- subset_samples(worle, matrix == \"soil\" & sample_day == \"Baseline\" & soil_type == \"border\" | \n                                matrix == \"soil\" & treatment == \"no_manure_strip\" & soil_type == \"border\") %>%\n  filter_taxa(function(x) sum(x) >= 1, T)\n\nworle.manure <- subset_samples(worle, matrix == \"manure\") %>%\n  filter_taxa(function(x) sum(x) >= 1, T)\n\nworle.water <- subset_samples(worle, matrix == \"water\" & unique_id != \"Comp-from-P8-7-10-26-17\") %>%\n  filter_taxa(function(x) sum(x) >= 1, T)\n\n\n# Make a list of ASVs associated with each type of soil and manure\nworle_manure_asvs <- taxa_names(worle.manure)\nworle_crop_soil_asvs <- taxa_names(worle.crop)\nworle_strip_soil_asvs <- taxa_names(worle.strip)\nworle_border_asvs <- taxa_names(worle.border)\nworle_water_asvs <- taxa_names(worle.water)\n\n# venn diagram\nworle_vvv_diag <- venn(list(\"Manure_ASVs\" = worle_manure_asvs, \"Crop_ASVs\" = worle_crop_soil_asvs, \"Strip_ASVs\" = worle_strip_soil_asvs, \"Border_ASVs\" = worle_border_asvs))\n\n\n\n# Access ASVs unique to each soil and manure and store\nworle_manure_persitors <- attr(worle_vvv_diag, \"intersections\")$Manure_ASVs\nworle_crop_persistors <- attr(worle_vvv_diag, \"intersections\")$Crop_ASVs\nworle_strip_persistors <- attr(worle_vvv_diag, \"intersection\")$Strip_ASVs\nworle_border_persistors <- attr(worle_vvv_diag, \"intersections\")$Border_ASVs\n\nWe have 1017 “MAB” taxa\n\nSample_Type <- c(\"Manure\", \"Crop\", \"Strip\", \"Border\")\nNumber_of_taxa <- c(ntaxa(worle.manure), ntaxa(worle.crop), ntaxa(worle.strip), ntaxa(worle.border))\nTaxa_unique_to <- c(length(worle_manure_persitors), length(worle_crop_persistors), length(worle_strip_persistors), length(worle_border_persistors))\n\ndf <- data.frame(Sample_Type, Number_of_taxa, Taxa_unique_to)\ndf\n\n  Sample_Type Number_of_taxa Taxa_unique_to\n1      Manure           1073           1017\n2        Crop          19002           9548\n3       Strip          18043           8518\n4      Border           8140           1868\n\n\nMake a taxonomy table of the ASVs unique to manure\n\nMAB <- tax_table(worle.manure) %>%\n  data.frame() %>%\n  rownames_to_column(\"ASV\") %>%\n  filter(ASV %in% worle_manure_persitors)\nhead(MAB)\n\n     ASV  Kingdom         Phylum          Class           Order\n1   ASV4 Bacteria     Firmicutes        Bacilli      Bacillales\n2 ASV184 Bacteria     Firmicutes        Bacilli      Bacillales\n3 ASV187 Bacteria     Firmicutes        Bacilli      Bacillales\n4 ASV244 Bacteria     Firmicutes        Bacilli Lactobacillales\n5 ASV246 Bacteria Actinobacteria Actinobacteria Actinomycetales\n6 ASV269 Bacteria     Firmicutes        Bacilli      Bacillales\n              Family           Genus\n1      Bacillaceae_2    Unclassified\n2      Bacillaceae_2  Oceanobacillus\n3      Bacillaceae_2    Unclassified\n4    Enterococcaceae    Enterococcus\n5 Corynebacteriaceae Corynebacterium\n6      Bacillaceae_2    Unclassified\n\nwrite.table(MAB, file = \"Tables/MAB.csv\", sep = \",\", col.names = T,\n            qmethod = \"double\", row.names = F)\n\n\nggvenn(list(\"Manure\" = worle_manure_asvs, \"Crop\" = worle_crop_soil_asvs, \"Strip\" = worle_strip_soil_asvs, \"Border\" = worle_border_asvs), set_name_size = 4, show_percentage = F) + scale_fill_viridis_d()\n\nScale for 'fill' is already present. Adding another scale for 'fill', which\nwill replace the existing scale.\n\n\n\n\nggsave(\"Figures/SuppFig2.png\", plot = last_plot(), units = \"in\", width = 6.5, dpi = 300)\n\nSaving 6.5 x 5 in image\n\n\nWe will assign taxa to two groups, soils associated and manure associated bacteria: “SAB” and “MAB”\n\ntax_association <- tax_table(worle.water) %>% \n  data.frame() %>%\n  rownames_to_column(\"ASV\") %>%\n  mutate(ASV_Association = ifelse(ASV %in% worle_manure_persitors, \"MAB\",\"SAB\")) %>%\n  mutate(asv = ASV) %>%\n  column_to_rownames(\"ASV\") %>%\n  rename(ASV = asv) %>%\n  as.matrix() \n\ntax_table(worle.water) <- tax_association\n\nNow subset water samples to just “MAB”.\n\n# Due to sequencing depth, we have a few MAB detected in CS plots, let's note them and remove them for \"clean\" plot. \nASVsinCS <- subset_samples(worle.water, treatment == \"no_manure_strip\") %>%\n  subset_taxa(ASV_Association == \"MAB\") %>% \n  psmelt()\n\nASVsinCS <- ASVsinCS %>%\n  filter(Abundance > 0) %>%\n  select(OTU, Abundance, Phylum, Class, Order, Family, Genus)\n\nremoveASVs <- ASVsinCS$OTU\n\ncleanwater <- subset_taxa(worle.water, !ASV %in% removeASVs)\n\n\nsp <- cleanwater %>%\n  transform_sample_counts(function(x) x / sum(x)) %>%\n  subset_taxa(ASV_Association == \"MAB\")\nsp\n\nphyloseq-class experiment-level object\notu_table()   OTU Table:         [ 489 taxa and 51 samples ]\nsample_data() Sample Data:       [ 51 samples by 12 sample variables ]\ntax_table()   Taxonomy Table:    [ 489 taxa by 8 taxonomic ranks ]\nrefseq()      DNAStringSet:      [ 489 reference sequences ]\n\n\n\n\nFigure 2\n\np <- phylogeny_profile(sp, classification = 'Phylum', treatment = c(\"treatment\"), merge = TRUE, relative_abundance = F) +\n  facet_nested(. ~ treatment + plot, scales = \"free\", space = \"free\") +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),\n        legend.position = \"top\") +\n  guides(fill = guide_legend(ncol=3)) +\n  labs(y = \"Relative abundance of MAB\") +\n  scale_x_discrete()\n\nScale for 'x' is already present. Adding another scale for 'x', which will\nreplace the existing scale.\n\ndf <- p$data %>%\n  separate(col = unique_id, into = c(\"p\", \"time\"), sep = \"-\") \n\nlevels(df$treatment) <- c(\"CL\", \"CSL\", \"CS\")\n\ndf$treatment <- ordered(df$treatment, levels = c(\"CS\", \"CSL\", \"CL\")) \n\nbreaks <- df %>%\n  filter(plot == 4, time == 3) %>%\n  group_by(Phylum) %>%\n  summarise(mean = mean(Abundance)) %>%\n  arrange(mean) %>% \n  select(Phylum) \n\ndf$Phylum <- factor(df$Phylum, levels = breaks$Phylum)\n\nmabbarplot <- ggplot(data = df, aes(x = time, y = Abundance, fill = Phylum)) +\n  geom_bar(stat = \"identity\", colour = \"black\") +\n  facet_nested(. ~ treatment + plot, scales = \"free\", space = \"free\") +\n  theme_classic() +\n  theme(\n    text = element_text(size = global_size, family = \"Times\"),\n    legend.position = \"top\",\n    panel.background = element_rect(color = 'black', size = 1.4),\n    strip.text.x = element_text(size = 10, face = 'bold'),\n    strip.background = element_rect(colour = 'black', size = 1.4),\n    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n    scale_fill_manual(aesthetics = \"fill\", values = subset(colors, names(colors) %in% df$Phylum), breaks = breaks$Phylum) +\n    labs(x = \"Sample time (min) after runoff\", y = \"Relative abundance of LAB\") +\n  scale_x_discrete(labels = c(\"1\" = \"2.5\", \"2\" = \"7.5\", \"3\" = \"12.5\", \"4\" = \"17.5\", \"5\" = \"22.5\", \"6\" = \"27.5\")) +\n  scale_y_continuous(labels = function(x) paste0(x*100, \"%\")) +\n  guides(fill = guide_legend(nrow = 4))\n\nmabbarplot\n\n\n\n\nThe relative abundance of phyla that represent the “MAB” taxa detected in runoff water.\n\nggsave(filename = \"Figures/Fig2.jpeg\", plot = last_plot(), device = \"jpeg\", width = 7, height = 6, units = \"in\", dpi = 350)\n\n\n\nFigure 3\nOnly plot 8 most abundant phyla to keep plot cleaner\n\nsummary <- df %>%\n  filter(!treatment == \"CS\") %>% # Remove no manure treatment\n  group_by(Phylum, \n           plot, \n           treatment) %>%\n  summarise( \n    n=n(),\n    mean=mean(Abundance),\n    sd=sd(Abundance)) %>%\n  mutate(se = sd/sqrt(n))  %>%\n  mutate(ic = se * qt((1-0.05)/2 + .5, n-1)) %>%\n  arrange(plot, -mean) %>% \n  ungroup()\n\n`summarise()` has grouped output by 'Phylum', 'plot'. You can override using the `.groups` argument.\n\nEightPhyla <- summary %>%\n  group_by(Phylum) %>%\n  mutate(mean = mean(mean)) %>%\n  arrange(-mean) %>%\n  select(Phylum) %>%\n  distinct() %>%\n  head(8) # Use head with n = 8 to select eight phyla\n\nsummary$plot <- as.factor(summary$plot)\n\nsummary <- summary %>%\n  filter(Phylum %in% EightPhyla$Phylum)\n\nggplot(summary, aes(x = reorder(Phylum, -mean), y = mean, fill = plot)) +\n  geom_bar(stat = \"identity\", \n           position = position_dodge(width = 1)) +\n  geom_errorbar(aes(x = reorder(Phylum, -mean), ymin = mean - ic, ymax = mean + ic), \n           position = position_dodge(width = 1), width = 0.2, colour = \"black\", size= 0.5) +\n  labs(y = \"Relative abundance of phyla\", x = \"Phylum\") +\n  facet_grid( ~ treatment) +\n  theme_classic() + \n  theme(text = element_text(size = global_size, family = \"Times\"),\n    axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_fill_viridis_d(name = \"Plot\") +\n  scale_y_continuous(labels = function(x) paste0(x*100, \"%\")) # Here we can multiply the relative abundance by 100 and add a % mark, note that any tables generated will still need to be multiplied by 100. \n\n\n\nggsave(filename = \"Figures/Fig3.jpeg\", plot = last_plot(), device = \"jpeg\", width = 7, height = 6, units = \"in\", dpi = 350)\n\nLAB treatment mean ::: {.cell}\ndf %>%\n  group_by(treatment, plot, time) %>%\n  summarise(\n    MAB_Abundance = sum(Abundance)) %>% \n  ungroup() %>%\n  group_by(treatment, plot) %>%\n  summarise(\n    mean_mab = mean(MAB_Abundance)) %>%\n  ungroup() %>%\n  group_by(plot) %>%\n  summarise(trtMeanMab = mean(mean_mab))\n\n`summarise()` has grouped output by 'treatment', 'plot'. You can override using the `.groups` argument.\n\n\n`summarise()` has grouped output by 'treatment'. You can override using the `.groups` argument.\n\n\n# A tibble: 9 x 2\n   plot trtMeanMab\n  <dbl>      <dbl>\n1     1    0      \n2     2    0      \n3     3    0      \n4     4    0.552  \n5     5    0.0110 \n6     6    0.00284\n7     7    0.0893 \n8     8    0.100  \n9     9    0.312  \n\n:::"
  }
]